let isRoot=!1,users=JSON.parse(localStorage.getItem("users"))||{user:"12345"},currentUser="user",currentDir="~",authenticated=!1,promptElement=document.getElementById("prompt"),outputElement=document.getElementById("output"),inputElement=document.getElementById("input");const rootDirectories={"/":["bin","boot","dev","etc","home","lib","lib64","media","mnt","opt","proc","root","run","sbin","srv","sys","tmp","usr","var"]},homeDirectories=["Documents","Downloads","Music","Pictures","Videos"];function initializeFilesystem(){if(localStorage.getItem("filesystem")){const e=JSON.parse(localStorage.getItem("filesystem"));for(let t in rootDirectories)e[t]||(e[t]=rootDirectories[t]);localStorage.setItem("filesystem",JSON.stringify(e))}else{const e={"/":rootDirectories["/"],"/home":{}};for(let t in users)"root"!==t&&(e[`/home/${t}`]=homeDirectories,homeDirectories.forEach((n=>{e[`/home/${t}/${n}`]=[]})));localStorage.setItem("filesystem",JSON.stringify(e))}}function getCurrentPath(){return"~"===currentDir?`/home/${currentUser}`:currentDir.startsWith("~")?`/home/${currentUser}${currentDir.slice(1)}`:currentDir}function resolvePath(e){return e.startsWith("/")?e:e.startsWith("~")?`/home/${currentUser}${e.slice(1)}`:`${getCurrentPath()}/${e}`}function updatePrompt(){isRoot?(promptElement.textContent=`root@electron:${currentDir}# `,promptElement.style.color="red"):(promptElement.textContent=`${currentUser}@divya-os:${currentDir}$ `,promptElement.style.color="violet")}function formatOutput(e){return e.map((e=>e.includes(".")?`<span style="color:pink;">${e}</span>`:`<span style="color:lightblue;">${e}</span>`)).join(" ")}function isProtectedDir(e){return"/"!==e&&rootDirectories["/"].some((t=>e.startsWith(`/${t}`)))}async function executeCommand(e){if(!e.trim())return"";let t="",n=e.split(" "),r=n[0],o=JSON.parse(localStorage.getItem("filesystem")),i=getCurrentPath();switch(r){case"sudo":if("su"===n[1]){"photon"===prompt("Enter password for sudo: ")?(isRoot=!0,authenticated=!0,currentUser="root",currentDir="/"):t="Authentication failure. Hint: photon"}else if("apt"===n[1]&&"update"===n[2]||"update"===n[1]){if(!authenticated){if("photon"!==prompt("Enter password for sudo: ")){t="Authentication failure. Hint: photon";break}authenticated=!0}t=""}else if("apt"===n[1]&&"upgrade"===n[2]||"upgrade"===n[1]){if(!authenticated){if("photon"!==prompt("Enter password for sudo: ")){t="Authentication failure. Hint: photon";break}authenticated=!0}if(n.includes("-y"))t="Reading package lists... Done\nBuilding dependency tree\nReading state information... Done\nCalculating upgrade... Done\nThe following packages will be upgraded:\n  electron-core electron-shell electron-utils libelectron1 libelectron-dev\n5 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 20.5 MB of archives.\nAfter this operation, 2,048 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://deb.electron.org/electron electron/main amd64 electron-core amd64 1.2.3-1 [4,215 kB]\nGet:2 http://deb.electron.org/electron electron/main amd64 electron-shell amd64 1.2.3-1 [10.2 MB]\nGet:3 http://deb.electron.org/electron electron/main amd64 electron-utils amd64 1.2.3-1 [2,320 kB]\nGet:4 http://deb.electron.org/electron electron/main amd64 libelectron1 amd64 1.2.3-1 [2,398 kB]\nGet:5 http://deb.electron.org/electron electron/main amd64 libelectron-dev amd64 1.2.3-1 [1,367 kB]\nFetched 20.5 MB in 4s (5,125 kB/s)\n(Reading database ... 145698 files and directories currently installed.)\nPreparing to unpack .../electron-core_1.2.3-1_amd64.deb ...\nUnpacking electron-core (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-shell_1.2.3-1_amd64.deb ...\nUnpacking electron-shell (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-utils_1.2.3-1_amd64.deb ...\nUnpacking electron-utils (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron1_1.2.3-1_amd64.deb ...\nUnpacking libelectron1 (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron-dev_1.2.3-1_amd64.deb ...\nUnpacking libelectron-dev (1.2.3-1) over (1.2.2-1) ...\nSetting up electron-core (1.2.3-1) ...\nSetting up electron-shell (1.2.3-1) ...\nSetting up electron-utils (1.2.3-1) ...\nSetting up libelectron1 (1.2.3-1) ...\nSetting up libelectron-dev (1.2.3-1) ...\nProcessing triggers for man-db (2.9.1-1) ...\nProcessing triggers for libc-bin (2.31-0ubuntu9.2) ...\nProcessing triggers for initramfs-tools (0.136ubuntu6.3) ...\nProcessing triggers for systemd (245.4-4ubuntu3.3) ...";else{t="y"===prompt("Do you want to continue? [Y/n]").toLowerCase()?"Reading package lists... Done\nBuilding dependency tree\nReading state information... Done\nCalculating upgrade... Done\nThe following packages will be upgraded:\n  electron-core electron-shell electron-utils libelectron1 libelectron-dev\n5 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 20.5 MB of archives.\nAfter this operation, 2,048 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://deb.electron.org/electron electron/main amd64 electron-core amd64 1.2.3-1 [4,215 kB]\nGet:2 http://deb.electron.org/electron electron/main amd64 electron-shell amd64 1.2.3-1 [10.2 MB]\nGet:3 http://deb.electron.org/electron electron/main amd64 electron-utils amd64 1.2.3-1 [2,320 kB]\nGet:4 http://deb.electron.org/electron electron/main amd64 libelectron1 amd64 1.2.3-1 [2,398 kB]\nGet:5 http://deb.electron.org/electron electron/main amd64 libelectron-dev amd64 1.2.3-1 [1,367 kB]\nFetched 20.5 MB in 4s (5,125 kB/s)\n(Reading database ... 145698 files and directories currently installed.)\nPreparing to unpack .../electron-core_1.2.3-1_amd64.deb ...\nUnpacking electron-core (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-shell_1.2.3-1_amd64.deb ...\nUnpacking electron-shell (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-utils_1.2.3-1_amd64.deb ...\nUnpacking electron-utils (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron1_1.2.3-1_amd64.deb ...\nUnpacking libelectron1 (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron-dev_1.2.3-1_amd64.deb ...\nUnpacking libelectron-dev (1.2.3-1) over (1.2.2-1) ...\nSetting up electron-core (1.2.3-1) ...\nSetting up electron-shell (1.2.3-1) ...\nSetting up electron-utils (1.2.3-1) ...\nSetting up libelectron1 (1.2.3-1) ...\nSetting up libelectron-dev (1.2.3-1) ...\nProcessing triggers for man-db (2.9.1-1) ...\nProcessing triggers for libc-bin (2.31-0ubuntu9.2) ...\nProcessing triggers for initramfs-tools (0.136ubuntu6.3) ...\nProcessing triggers for systemd (245.4-4ubuntu3.3) ...":"Operation cancelled."}}else t=`Command not found: ${e}`;break;case"apt":if("update"===n[1])t="Get:1 http://security.electron.org electron-security InRelease [44.1 kB]\nGet:2 http://deb.electron.org/electron electron InRelease [113 kB]\nGet:3 http://deb.electron.org/electron electron-updates InRelease [44.1 kB]\nGet:4 http://deb.electron.org/electron electron/main amd64 Packages [7,068 kB]\nGet:5 http://deb.electron.org/electron electron-updates/main amd64 Packages [785 kB]\nGet:6 http://security.electron.org electron-security/main amd64 Packages [268 kB]\nFetched 8,322 kB in 3s (2,775 kB/s)\nReading package lists... Done\nBuilding dependency tree\nReading state information... Done\nAll packages are up to date.";else if("upgrade"===n[1])if(n.includes("-y"))t="Reading package lists... Done\nBuilding dependency tree\nReading state information... Done\nCalculating upgrade... Done\nThe following packages will be upgraded:\n  electron-core electron-shell electron-utils libelectron1 libelectron-dev\n5 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 20.5 MB of archives.\nAfter this operation, 2,048 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://deb.electron.org/electron electron/main amd64 electron-core amd64 1.2.3-1 [4,215 kB]\nGet:2 http://deb.electron.org/electron electron/main amd64 electron-shell amd64 1.2.3-1 [10.2 MB]\nGet:3 http://deb.electron.org/electron electron/main amd64 electron-utils amd64 1.2.3-1 [2,320 kB]\nGet:4 http://deb.electron.org/electron electron/main amd64 libelectron1 amd64 1.2.3-1 [2,398 kB]\nGet:5 http://deb.electron.org/electron electron/main amd64 libelectron-dev amd64 1.2.3-1 [1,367 kB]\nFetched 20.5 MB in 4s (5,125 kB/s)\n(Reading database ... 145698 files and directories currently installed.)\nPreparing to unpack .../electron-core_1.2.3-1_amd64.deb ...\nUnpacking electron-core (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-shell_1.2.3-1_amd64.deb ...\nUnpacking electron-shell (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-utils_1.2.3-1_amd64.deb ...\nUnpacking electron-utils (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron1_1.2.3-1_amd64.deb ...\nUnpacking libelectron1 (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron-dev_1.2.3-1_amd64.deb ...\nUnpacking libelectron-dev (1.2.3-1) over (1.2.2-1) ...\nSetting up electron-core (1.2.3-1) ...\nSetting up electron-shell (1.2.3-1) ...\nSetting up electron-utils (1.2.3-1) ...\nSetting up libelectron1 (1.2.3-1) ...\nSetting up libelectron-dev (1.2.3-1) ...\nProcessing triggers for man-db (2.9.1-1) ...\nProcessing triggers for libc-bin (2.31-0ubuntu9.2) ...\nProcessing triggers for initramfs-tools (0.136ubuntu6.3) ...\nProcessing triggers for systemd (245.4-4ubuntu3.3) ...";else{t="y"===prompt("Do you want to continue? [Y/n]").toLowerCase()?"Reading package lists... Done\nBuilding dependency tree\nReading state information... Done\nCalculating upgrade... Done\nThe following packages will be upgraded:\n  electron-core electron-shell electron-utils libelectron1 libelectron-dev\n5 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 20.5 MB of archives.\nAfter this operation, 2,048 kB of additional disk space will be used.\nDo you want to continue? [Y/n] y\nGet:1 http://deb.electron.org/electron electron/main amd64 electron-core amd64 1.2.3-1 [4,215 kB]\nGet:2 http://deb.electron.org/electron electron/main amd64 electron-shell amd64 1.2.3-1 [10.2 MB]\nGet:3 http://deb.electron.org/electron electron/main amd64 electron-utils amd64 1.2.3-1 [2,320 kB]\nGet:4 http://deb.electron.org/electron electron/main amd64 libelectron1 amd64 1.2.3-1 [2,398 kB]\nGet:5 http://deb.electron.org/electron electron/main amd64 libelectron-dev amd64 1.2.3-1 [1,367 kB]\nFetched 20.5 MB in 4s (5,125 kB/s)\n(Reading database ... 145698 files and directories currently installed.)\nPreparing to unpack .../electron-core_1.2.3-1_amd64.deb ...\nUnpacking electron-core (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-shell_1.2.3-1_amd64.deb ...\nUnpacking electron-shell (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../electron-utils_1.2.3-1_amd64.deb ...\nUnpacking electron-utils (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron1_1.2.3-1_amd64.deb ...\nUnpacking libelectron1 (1.2.3-1) over (1.2.2-1) ...\nPreparing to unpack .../libelectron-dev_1.2.3-1_amd64.deb ...\nUnpacking libelectron-dev (1.2.3-1) over (1.2.2-1) ...\nSetting up electron-core (1.2.3-1) ...\nSetting up electron-shell (1.2.3-1) ...\nSetting up electron-utils (1.2.3-1) ...\nSetting up libelectron1 (1.2.3-1) ...\nSetting up libelectron-dev (1.2.3-1) ...\nProcessing triggers for man-db (2.9.1-1) ...\nProcessing triggers for libc-bin (2.31-0ubuntu9.2) ...\nProcessing triggers for initramfs-tools (0.136ubuntu6.3) ...\nProcessing triggers for systemd (245.4-4ubuntu3.3) ...":"Operation cancelled."}else t=`Command not found: ${e}`;break;case"ls":let r=n[1]?resolvePath(n[1]):i;t=isRoot&&isProtectedDir(r)?`ls: cannot access '${n[1]}': Permission denied`:o[r]?formatOutput(o[r]):`ls: cannot access '${n[1]}': No such file or directory`;break;case"cd":if(n[1]){let e=resolvePath(n[1]);isRoot&&isProtectedDir(e)?t=`bash: cd: ${n[1]}: Permission denied`:o[e]?currentDir="/"===e?"/":e.replace(`/home/${currentUser}`,"~"):t=`bash: cd: ${n[1]}: No such file or directory`}else currentDir="~";break;case"pwd":t=getCurrentPath();break;case"whoami":t=currentUser;break;case"uname":t="-a"===n[1]?"Electron v1.1.3 (beta)":"Usage: uname -a";break;case"python":t="--version"===n[1]?"Python 3.12.3":"Usage: python --version";break;case"adduser":if(n[1]){let e=n[1],r=prompt("Set a new password: ");r===prompt("Enter the password again: ")?(users[e]=r,localStorage.setItem("users",JSON.stringify(users)),o[`/home/${e}`]=homeDirectories,homeDirectories.forEach((t=>{o[`/home/${e}/${t}`]=[]})),localStorage.setItem("filesystem",JSON.stringify(o)),t=`Added user ${e}.`):t="Passwords do not match. Try again."}else t="Usage: adduser <username>";break;case"login":if(n[1]){let e=n[1],r=prompt("Password: ");users[e]&&users[e]===r?(currentUser=e,currentDir="~",t=`Logged in as ${e}`):t="Login incorrect"}else t="Usage: login <username>";break;case"exit":isRoot?(isRoot=!1,authenticated=!1,currentUser="user",currentDir="~"):t="No more processes left to exit.";break;case"clear":return outputElement.innerHTML="","";case"ifconfig":t="eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n    inet 192.168.1.100  netmask 255.255.255.0  broadcast 192.168.1.255\n    inet6 fe80::a00:27ff:fe4e:66a1  prefixlen 64  scopeid 0x20<link>\n    ether 08:00:27:4e:66:a1  txqueuelen 1000  (Ethernet)\n    RX packets 215265  bytes 327264500 (312.1 MiB)\n    RX errors 0  dropped 0  overruns 0  frame 0\n    TX packets 155209  bytes 14030524 (13.3 MiB)\n    TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n    inet 127.0.0.1  netmask 255.0.0.0\n    inet6 ::1  prefixlen 128  scopeid 0x10<host>\n    loop  txqueuelen 1000  (Local Loopback)\n    RX packets 0  bytes 0 (0.0 B)\n    RX errors 0  dropped 0  overruns 0  frame 0\n    TX packets 0  bytes 0 (0.0 B)\n    TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0";break;case"nano":if(n[1]){let e=n[1],r=resolvePath(e),i=o[r]||"";i=prompt("Enter file content: ",i),o[r]=i;let l=r.substring(0,r.lastIndexOf("/"));o[l].includes(e)||o[l].push(e),localStorage.setItem("filesystem",JSON.stringify(o)),t=`Created file ${e}.`}else t="Usage: nano <filename>";break;case"cat":let l=n[1]?resolvePath(n[1]):"";t=isRoot&&isProtectedDir(l)?`cat: ${n[1]}: Permission denied`:o[l]?o[l]:`cat: ${n[1]}: No such file or directory`;break;case"mkdir":if(n[1]){let e=n[1],r=resolvePath(e);o[r]=[];let i=r.substring(0,r.lastIndexOf("/"));o[i].includes(e)||o[i].push(e),localStorage.setItem("filesystem",JSON.stringify(o)),t=`Created directory ${e}.`}else t="Usage: mkdir <directory>";break;case"rmdir":if(n[1]){let e=n[1],r=resolvePath(e);if(isRoot&&isProtectedDir(r))t=`rmdir: failed to remove '${e}': Permission denied`;else if(o[r]&&0===o[r].length){delete o[r];let n=r.substring(0,r.lastIndexOf("/"));o[n]=o[n].filter((t=>t!==e)),localStorage.setItem("filesystem",JSON.stringify(o)),t=`Removed directory ${e}.`}else t=`rmdir: failed to remove '${e}': Directory not empty or does not exist.`}else t="Usage: rmdir <directory>";break;case"rm":if("-rf"===n[1]&&n[2]){let e=resolvePath(n[2]);if(isRoot&&isProtectedDir(e))t=`rm: cannot remove '${n[2]}': Permission denied`;else if(o[e]){!function e(t){Array.isArray(o[t])&&o[t].forEach((n=>e(`${t}/${n}`))),delete o[t]}(e);let r=e.substring(0,e.lastIndexOf("/"));o[r]=o[r].filter((e=>e!==n[2])),localStorage.setItem("filesystem",JSON.stringify(o)),t=`Removed ${n[2]}`}else t=`rm: cannot remove '${n[2]}': No such file or directory`}else if(n[1]){let e=n[1],r=resolvePath(e);if(isRoot&&isProtectedDir(r))t=`rm: cannot remove '${e}': Permission denied`;else if(o[r]){delete o[r];let n=r.substring(0,r.lastIndexOf("/"));o[n]=o[n].filter((t=>t!==e)),localStorage.setItem("filesystem",JSON.stringify(o)),t=`Removed file ${e}.`}else t=`rm: cannot remove '${e}': No such file`}else t="Usage: rm <file>";break;case"trace":if("-m"===n[1])t=await fetchIpInfo();else if("-t"===n[1]&&n[2]){const e=n[2];t=await fetchIpInfo(e)}else t="Usage: trace -m | trace -t <IP address>";break;case"gui":if("--start"===n[1]){const e=document.createElement("style");e.innerHTML="\n                    .blurred {\n                        filter: blur(10px);\n                        transition: filter 0.5s ease;\n                    }\n                ",document.head.appendChild(e),document.body.classList.add("blurred");const n=document.createElement("iframe");n.src="assets/GUI/index.html",n.style.width="100vw",n.style.height="100vh",n.style.border="none",n.onload=()=>{document.body.classList.remove("blurred")},setTimeout((()=>{document.body.innerHTML="",document.body.appendChild(n)}),500),t="GUI started."}else"--kill"===n[1]?(location.reload(),t="GUI killed."):t="Usage: gui --start | gui --kill";break;default:t=`Command not found: ${e}`}return t}async function fetchIpInfo(e=""){const t=await fetch(`https://ipapi.co/${e}/json/`),n=await t.json(),{ip:r,city:o,region:i,country_name:l,timezone:a,org:s,asn:c,latitude:d,longitude:u,utc_offset:p}=n;return`IP: ${r}\nCity: ${o}\nRegion: ${i}\nCountry: ${l}\nTimezone: ${a}\nLocal Time: ${(new Date).toLocaleString("en-US",{timeZone:a})}\nISP: ${s}\nASN: ${c}\nLatitude: ${d}\nLongitude: ${u}`}inputElement.addEventListener("keydown",(async function(e){if("Enter"===e.key){let e=inputElement.value,t=await executeCommand(e);outputElement.innerHTML+=t?`<div><span style="color:${promptElement.style.color};">${promptElement.textContent}</span> ${e}</div><div style="color:lime; text-align:left;">${t}</div>`:`<div><span style="color:${promptElement.style.color};">${promptElement.textContent}</span> ${e}</div>`,inputElement.value="",updatePrompt(),outputElement.scrollTop=outputElement.scrollHeight}})),initializeFilesystem(),updatePrompt();
